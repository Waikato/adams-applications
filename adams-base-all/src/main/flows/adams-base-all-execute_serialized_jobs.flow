# Project: adams
# Date: 2015-09-18 16:22:44
# User: fracpete
# Charset: UTF-8
#
adams.flow.control.Flow
	-annotation
	Executes serialized jobs that appear in the ${TMP} directory.\n(file extension: .ser)\nFor remote jobs, the SSHConnection configuration may\nrequire adapting.
	-actor
		adams.flow.standalone.SSHConnection
			-authentication-type
			PUBLIC_KEY
	-actor
		adams.flow.source.Start
	-actor
		adams.flow.control.WhileLoop
			-condition
				adams.flow.condition.bool.True
			-loop
				adams.flow.source.Start
			-loop
				adams.flow.control.Trigger
					-name
					jobs?
					-tee
						adams.flow.source.FileSystemSearch
							-search
								adams.flow.source.filesystemsearch.FileSearch
									-directory
									${TMP}
									-regexp
									to_rank.ser
					-tee
						adams.flow.control.Tee
							-name
							info
							-tee
								adams.flow.sink.Console
									-prefix
									jobs: 
					-tee
						adams.flow.control.Tee
							-name
							archive file
							-tee
								adams.flow.transformer.Convert
									-conversion
										adams.data.conversion.ReplaceFileExtension
											-extension
											.done
							-tee
								adams.flow.transformer.SetVariable
									-var-name
									archive
					-tee
						adams.flow.transformer.WaitForFile
					-tee
						adams.flow.control.Tee
							-name
							execute
							-tee
								adams.flow.transformer.Deserialize
							-tee
								adams.flow.transformer.ExecuteJobs
					-tee
						adams.flow.transformer.MoveFile
							-file
							@{archive}
							-atomic-move
							true
							-output-moved-file
							true
					-tee
						adams.flow.sink.Console
							-prefix
							archived: 
			-loop
				adams.flow.control.Sleep
					-interval
					500
	-flow-execution-listener
		adams.flow.execution.NullListener

